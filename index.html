<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>arXiv Headlines</title>
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      },
      svg: {
        fontCache: 'global'
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" async></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body{
      font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px;
      transition: background 0.3s ease;
    }

    /* Background themes */
    body.theme-purple{
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    body.theme-ocean{
      background: linear-gradient(135deg, #2E3192 0%, #1BFFFF 100%);
    }
    body.theme-sunset{
      background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
    }
    body.theme-forest{
      background: linear-gradient(135deg, #134E5E 0%, #71B280 100%);
    }
    body.theme-night{
      background: linear-gradient(135deg, #2C3E50 0%, #4CA1AF 100%);
    }
    body.theme-rose{
      background: linear-gradient(135deg, #ED4264 0%, #FFEDBC 100%);
    }
    body.theme-dark{
      background: linear-gradient(135deg, #0F0F0F 0%, #2D2D2D 100%);
    }

    /* Theme-specific card colors */
    body.theme-purple .paper-card::before{
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }
    body.theme-purple .paper-card.selected{
      border-color: #667eea;
      box-shadow: 0 8px 24px rgba(102,126,234,0.3);
    }
    body.theme-purple .abstract-card,
    body.theme-purple .pdf-card{
      border-color: #667eea;
      box-shadow: 
        -4px -4px 0 0 #764ba2,
        -8px -8px 0 0 rgba(118, 75, 162, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-ocean .paper-card::before{
      background: linear-gradient(180deg, #2E3192 0%, #1BFFFF 100%);
    }
    body.theme-ocean .paper-card.selected{
      border-color: #2E3192;
      box-shadow: 0 8px 24px rgba(46,49,146,0.3);
    }
    body.theme-ocean .abstract-card,
    body.theme-ocean .pdf-card{
      border-color: #2E3192;
      box-shadow: 
        -4px -4px 0 0 #1BFFFF,
        -8px -8px 0 0 rgba(27, 255, 255, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-sunset .paper-card::before{
      background: linear-gradient(180deg, #FF512F 0%, #F09819 100%);
    }
    body.theme-sunset .paper-card.selected{
      border-color: #FF512F;
      box-shadow: 0 8px 24px rgba(255,81,47,0.3);
    }
    body.theme-sunset .abstract-card,
    body.theme-sunset .pdf-card{
      border-color: #FF512F;
      box-shadow: 
        -4px -4px 0 0 #F09819,
        -8px -8px 0 0 rgba(240, 152, 25, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-forest .paper-card::before{
      background: linear-gradient(180deg, #134E5E 0%, #71B280 100%);
    }
    body.theme-forest .paper-card.selected{
      border-color: #134E5E;
      box-shadow: 0 8px 24px rgba(19,78,94,0.3);
    }
    body.theme-forest .abstract-card,
    body.theme-forest .pdf-card{
      border-color: #134E5E;
      box-shadow: 
        -4px -4px 0 0 #71B280,
        -8px -8px 0 0 rgba(113, 178, 128, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-night .paper-card::before{
      background: linear-gradient(180deg, #2C3E50 0%, #4CA1AF 100%);
    }
    body.theme-night .paper-card.selected{
      border-color: #2C3E50;
      box-shadow: 0 8px 24px rgba(44,62,80,0.3);
    }
    body.theme-night .abstract-card,
    body.theme-night .pdf-card{
      border-color: #2C3E50;
      box-shadow: 
        -4px -4px 0 0 #4CA1AF,
        -8px -8px 0 0 rgba(76, 161, 175, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-rose .paper-card::before{
      background: linear-gradient(180deg, #ED4264 0%, #FFEDBC 100%);
    }
    body.theme-rose .paper-card.selected{
      border-color: #ED4264;
      box-shadow: 0 8px 24px rgba(237,66,100,0.3);
    }
    body.theme-rose .abstract-card,
    body.theme-rose .pdf-card{
      border-color: #ED4264;
      box-shadow: 
        -4px -4px 0 0 #FFEDBC,
        -8px -8px 0 0 rgba(255, 237, 188, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    body.theme-dark .paper-card::before{
      background: linear-gradient(180deg, #0F0F0F 0%, #2D2D2D 100%);
    }
    body.theme-dark .paper-card.selected{
      border-color: #2D2D2D;
      box-shadow: 0 8px 24px rgba(45,45,45,0.5);
    }
    body.theme-dark .abstract-card,
    body.theme-dark .pdf-card{
      border-color: #2D2D2D;
      box-shadow: 
        -4px -4px 0 0 #0F0F0F,
        -8px -8px 0 0 rgba(15, 15, 15, 0.5),
        0 10px 30px rgba(0,0,0,0.18);
    }
    /* Theme-specific button colors */
    body.theme-ocean button:not(.range-btn):not(.col-btn),
    body.theme-ocean .range-btn.active,
    body.theme-ocean .col-btn.active{
      background: #2E3192;
      border-color: #2E3192;
    }

    body.theme-sunset button:not(.range-btn):not(.col-btn),
    body.theme-sunset .range-btn.active,
    body.theme-sunset .col-btn.active{
      background: #FF512F;
      border-color: #FF512F;
    }

    body.theme-forest button:not(.range-btn):not(.col-btn),
    body.theme-forest .range-btn.active,
    body.theme-forest .col-btn.active{
      background: #134E5E;
      border-color: #134E5E;
    }

    body.theme-night button:not(.range-btn):not(.col-btn),
    body.theme-night .range-btn.active,
    body.theme-night .col-btn.active{
      background: #2C3E50;
      border-color: #2C3E50;
    }

    body.theme-rose button:not(.range-btn):not(.col-btn),
    body.theme-rose .range-btn.active,
    body.theme-rose .col-btn.active{
      background: #ED4264;
      border-color: #ED4264;
    }

    body.theme-dark button:not(.range-btn):not(.col-btn),
    body.theme-dark .range-btn.active,
    body.theme-dark .col-btn.active{
      background: #2D2D2D;
      border-color: #2D2D2D;
    }


    .layout{
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      align-items: start;
    }

    .header{
      padding: 22px 18px;
      border-radius: 16px;
      margin-bottom: 14px;
      background: transparent;
      box-shadow: none;
      text-align: center;
    }
    .header h1{ 
      color: white;
      font-size: 2.8em; 
      margin-bottom: 8px;
      font-weight: 900;
      letter-spacing: -0.02em;
      text-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .header p{ 
      color: rgba(255,255,255,0.9);
      font-size: 1.02em; 
      line-height: 1.4;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .main{ padding: 18px; }

    /* Tab-style category bar */
    .category-tabs{
      background: transparent;
      margin-bottom: 12px;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      align-items: flex-end;
    }

    .category-tab{
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(255,255,255,0.25);
      border-bottom: none;
      border-radius: 12px 12px 0 0;
      padding: 12px 20px;
      color: rgba(255,255,255,0.85);
      font-weight: 700;
      font-size: 0.92em;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      white-space: nowrap;
    }

    .category-tab:hover{
      background: rgba(255,255,255,0.25);
      color: white;
      transform: translateY(-2px);
    }

    .category-tab.active{
      background: white;
      color: #667eea;
      border-color: white;
      font-weight: 800;
      transform: translateY(0);
      box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    }

    .category-tab.active::after{
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: white;
    }

    .controls{
      background: white;
      padding: 14px;
      border-radius: 16px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.10);
      margin-bottom: 12px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .controls .group{
      display:flex;
      gap: 10px;
      align-items:center;
      flex: 1;
      min-width: 200px;
    }

    label{
      color:#555;
      font-size: 0.95em;
      font-weight: 700;
      white-space: nowrap;
    }

    select, input[type="date"], button{
      padding: 10px 14px;
      border-radius: 10px;
      border: 2px solid #667eea;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s ease;
      background: white;
      width: 100%;
    }

    select{
      font-weight: 600;
    }

    button{
      background: #667eea;
      color: white;
      font-weight: 850;
      border: 2px solid #667eea;
      width: auto;
      min-width: 120px;
    }
    button:hover:not(:disabled){
      background: #5568d3;
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(102,126,234,0.35);
    }
    button:disabled{
      background:#b7b7b7;
      border-color:#b7b7b7;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .range-toggle{
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .range-btn{
      padding: 10px 16px;
      border-radius: 10px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      font-size: 0.9em;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 80px;
    }

    .range-btn:hover{
      background: #f2f5ff;
    }

    .range-btn.active{
      background: #667eea;
      color: white;
    }

    /* Theme selector */
    .theme-selector{
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .theme-dot{
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: all 0.2s ease;
      position: relative;
    }

    .theme-dot:hover{
      transform: scale(1.15);
    }

    .theme-dot.active{
      border-color: #667eea;
      box-shadow: 0 0 0 2px white, 0 0 8px rgba(102,126,234,0.5);
    }

    .theme-dot.purple{ background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .theme-dot.ocean{ background: linear-gradient(135deg, #2E3192 0%, #1BFFFF 100%); }
    .theme-dot.sunset{ background: linear-gradient(135deg, #FF512F 0%, #F09819 100%); }
    .theme-dot.forest{ background: linear-gradient(135deg, #134E5E 0%, #71B280 100%); }
    .theme-dot.night{ background: linear-gradient(135deg, #2C3E50 0%, #4CA1AF 100%); }
    .theme-dot.rose{ background: linear-gradient(135deg, #ED4264 0%, #FFEDBC 100%); }
    .theme-dot.dark{ background: linear-gradient(135deg, #0F0F0F 0%, #2D2D2D 100%); }

    .status{
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.35);
      color: rgba(255,255,255,0.95);
      padding: 12px 14px;
      border-radius: 14px;
      margin-bottom: 14px;
      line-height: 1.5;
    }

    .error{
      background: #fff1f1;
      color: #b3261e;
      padding: 14px;
      border-radius: 14px;
      margin: 14px 0;
      line-height: 1.6;
    }

    .info{
      background: #e3f2fd;
      color: #1565c0;
      padding: 14px;
      border-radius: 14px;
      margin: 14px 0;
      line-height: 1.6;
      font-weight: 600;
    }

    .section{
      margin-bottom: 18px;
    }
    .section-title{
      display:flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.22);
      border: 1px solid rgba(255,255,255,0.35);
      color: rgba(255,255,255,0.95);
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
    }
    .section-title .left{
      display:flex;
      gap: 10px;
      align-items: center;
      font-weight: 850;
    }
    .section-title .right{
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .pill{
      background: rgba(255,255,255,0.25);
      border: 1px solid rgba(255,255,255,0.35);
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 750;
    }

    /* Column toggle buttons in section header */
    .column-toggle-mini{
      display: flex;
      gap: 4px;
      align-items: center;
      background: rgba(255,255,255,0.15);
      padding: 4px 6px;
      border-radius: 8px;
    }

    .col-btn{
      background: transparent;
      border: 2px solid rgba(255,255,255,0.4);
      color: rgba(255,255,255,0.85);
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 900;
      line-height: 1;
      transition: all 0.2s ease;
      min-width: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .col-btn:hover{
      background: rgba(255,255,255,0.25);
      border-color: rgba(255,255,255,0.7);
    }

    .col-btn.active{
      background: white;
      color: #667eea;
      border-color: white;
    }

    .papers-grid{
      display: grid;
      gap: 18px;
      width: 100%;
      margin-bottom: 8px;
    }

    .papers-grid.cols-1{
      grid-template-columns: 1fr;
    }
    .papers-grid.cols-2{
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    }

    .paper-card{
      background: white;
      border-radius: 14px;
      padding: 20px 18px 18px 22px;
      box-shadow: 0 5px 16px rgba(0,0,0,0.10);
      transition: all 0.25s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      display:flex;
      flex-direction: column;
    }
    .paper-card:hover{ transform: translateY(-4px); box-shadow: 0 14px 34px rgba(0,0,0,0.18); }
    .paper-card.selected{
      border: 3px solid #667eea;
      box-shadow: 0 8px 24px rgba(102,126,234,0.3);
    }
    .paper-card::before{
      content:'';
      position:absolute;
      top:0; left:0;
      width: 5px; height: 100%;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
    }
    .paper-title{ color:#222; font-size: 1.05em; font-weight: 900; margin-bottom: 10px; line-height: 1.4; }
    .paper-authors{ color:#666; font-size: 0.88em; margin-bottom: 10px; font-style: italic; }
    .paper-date{
      color:#999;
      font-size: 0.82em;
      margin-bottom: 10px;
      font-weight: 600;
    }
    .paper-footer{ 
      margin-top: auto;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .paper-link{
      color:#465bd6;
      text-decoration:none;
      font-weight: 900;
      font-size: 0.92em;
      display:inline-block;
    }
    .paper-link:hover{ text-decoration: underline; }

    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    /* Two-column layout: List | (Abstract + PDF vertically stacked) */
    .content-split{
      display: grid;
      grid-template-columns: 5fr 5fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 1150px){
      .content-split{ grid-template-columns: 1fr; }
    }

    /* Right panel container */
    .preview-panels{
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: sticky;
      top: 16px;
      height: calc(100vh - 32px);
      max-height: calc(100vh - 32px);
    }

    @media (max-width: 1150px){
      .preview-panels{ 
        position: static; 
        height: auto;
        max-height: none; 
      }
    }

    /* Abstract card - 3D border */
    .abstract-card{
      background: white;
      border-radius: 16px;
      padding: 16px;
      overflow-y: auto;
      flex: 2.5 0 0;
      min-height: 0;
      border: 3px solid #667eea;
      box-shadow: 
        -4px -4px 0 0 #764ba2,
        -8px -8px 0 0 rgba(118, 75, 162, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    /* PDF card - 3D border */
    .pdf-card{
      background: white;
      border-radius: 16px;
      padding: 16px;
      flex: 2 0 0;
      min-height: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
      border: 3px solid #667eea;
      box-shadow: 
        -4px -4px 0 0 #764ba2,
        -8px -8px 0 0 rgba(118, 75, 162, 0.3),
        0 10px 30px rgba(0,0,0,0.18);
    }

    /* PDF title bar */
    .pdf-section-title{
      font-size: 1.1em;
      font-weight: 800;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-shrink: 0;
    }

    .preview-muted{
      color: #666;
      font-size: 0.95em;
      line-height: 1.6;
    }
    .preview-title{
      font-size: 1.3em;
      font-weight: 950;
      color: #222;
      line-height: 1.35;
      margin-bottom: 10px;
    }
    .preview-meta{
      color:#666;
      font-size: 0.92em;
      margin-bottom: 10px;
      line-height: 1.5;
      font-style: italic; 
    }
    .preview-abstract{
      color:#333;
      font-size: 1.0em;
      line-height: 1.65;
      white-space: pre-wrap;
      word-break: break-word;
      padding-right: 6px;
    }

    .pdf-actions{
      display: flex;
      gap: 8px;
    }
    .pdf-btn{
      padding: 6px 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 700;
      transition: all 0.2s;
      text-decoration: none;
      display: inline-block;
    }
    .pdf-btn:hover{
      background: #5568d3;
      transform: translateY(-1px);
    }
    .pdf-btn.secondary{
      background: #e8edff;
      color: #465bd6;
    }
    .pdf-btn.secondary:hover{
      background: #d0dcff;
    }

    /* PDF iframe container */
    .pdf-viewer-container{
      width: 100%;
      flex: 1;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f5;
      position: relative;
      min-height: 0;
    }

    .pdf-iframe{
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    .paper-card[tabindex="0"]:focus{
      outline: 3px solid rgba(102,126,234,0.45);
      outline-offset: 2px;
    }

    .back-to-top{
      position: fixed;
      left: 16px;
      bottom: 16px;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.45);
      background: rgba(32,32,32,0.45);
      color: white;
      font-weight: 950;
      box-shadow: 0 12px 28px rgba(0,0,0,0.28);
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(6px);
    }
    .back-to-top:hover{ background: rgba(32,32,32,0.62); }
    .back-to-top:active{ transform: translateY(1px); }

    .pdf-toggle{
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      user-select: none;
      font-size: 0.9em;
      color: #667eea;
      font-weight: 700;
    }
    .pdf-toggle input{
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    /* ---------------------------
   Mobile: list-only responsive layout
   --------------------------- */
/* ---------------------------
   Mobile: truly responsive sizing
   --------------------------- */
  @media (max-width: 768px){

    /* English comment: Reduce global scale a bit */
    html{ font-size: 14px; }
    body{ padding: 10px; }

    /* English comment: Header smaller */
    .header{ padding: 12px 10px; margin-bottom: 10px; }
    .header h1{ font-size: 2.0em; }
    .header p{ font-size: 0.95em; }

    /* English comment: Tabs scroll instead of wrapping huge */
    .category-tabs{
      flex-wrap: nowrap;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      gap: 6px;
      padding-bottom: 6px;
    }
    .category-tab{
      flex: 0 0 auto;
      padding: 10px 14px;
      font-size: 0.9em;
    }

    /* English comment: Controls must not be forced wide by min-width */
    .controls{
      padding: 12px;
      gap: 10px;
    }
    .controls .group{
      flex: 1 1 100% !important;
      min-width: 0 !important;      /* overrides 200px */
      max-width: none !important;
    }

    /* English comment: Override inline min-width/max-width on groups */
    .controls .group[style]{
      min-width: 0 !important;
      max-width: none !important;
      width: 100% !important;
    }

    label{ font-size: 0.9em; }

    /* English comment: Inputs smaller */
    select, input[type="date"]{
      padding: 9px 12px;
      font-size: 0.95em;
    }

    /* English comment: Buttons smaller and not too wide */
    button{
      padding: 9px 12px;
      font-size: 0.95em;
      min-width: 0 !important;      /* overrides 120px */
    }

    .range-toggle{ flex-wrap: wrap; }
    .range-btn{
      min-width: 0 !important;      /* overrides 80px */
      width: auto;
      flex: 1 1 auto;
      padding: 9px 10px;
      font-size: 0.9em;
    }

    /* English comment: List-only layout (if‰Ω†Â∑≤ÁªèÊåâÂâçÈù¢ÈöêËóèÈ¢ÑËßà‰∫ÜÔºåÂèØ‰øùÁïô) */
    .content-split{ grid-template-columns: 1fr !important; gap: 12px; }
    .preview-panels{ display: none !important; }
    .pdf-toggle{ display: none !important; }

    /* English comment: Cards 1 column and tighter */
    .papers-grid.cols-2{ grid-template-columns: 1fr !important; }
    .paper-card{ padding: 14px 14px 12px 18px; }
    .paper-title{ font-size: 1.0em; }
    .paper-authors{ font-size: 0.85em; }
    .paper-date{ font-size: 0.8em; }
  }
  /* ---------------------------
   Mobile overflow fix (must be at very end)
   --------------------------- */
  html, body{
    width: 100%;
    max-width: 100%;
    overflow-x: hidden; /* English comment: Prevent horizontal overflow forcing zoomed layout */
  }

  /* English comment: Ensure flex/grid children can shrink */
  .layout, .main, .controls, .content-split, #content, #listPane, .section, .papers-grid, .paper-card{
    min-width: 0;
    max-width: 100%;
  }

  /* English comment: Inputs on iOS can be "stubborn"; force them to fit */
  @media (max-width: 768px){
    input[type="date"], select{
      max-width: 100% !important;
      min-width: 0 !important;
    }

    /* English comment: Let button text wrap instead of forcing width */
    button{
      max-width: 100% !important;
      white-space: normal;
    }

    /* English comment: Make links never force horizontal scroll */
    .paper-footer{ min-width: 0; }
    .paper-link{
      word-break: break-word;
      overflow-wrap: anywhere;
    }
  }

  </style>
</head>

<body class="theme-purple">
  <div class="layout">
    <main class="main">
      <div class="header">
        <h1>arXiv Headlines</h1>
        <p> </p>
      </div>

      <!-- Tab-style category selector -->
      <div class="category-tabs" id="categoryTabs"></div>

      <div class="controls">
        <div class="group" style="max-width: 280px;">
          <label for="day">Date</label>
          <input id="day" type="date" />
        </div>

        <div class="group" style="min-width: 240px;">
          <label>Range</label>
          <div class="range-toggle">
            <button class="range-btn active" data-range="1" onclick="setDateRange(1)">Today</button>
            <button class="range-btn" data-range="3" onclick="setDateRange(3)">3 Days</button>
            <button class="range-btn" data-range="7" onclick="setDateRange(7)">1 Week</button>
          </div>
        </div>
        
        <div class="group" style="min-width: 240px;">
          <label>Theme</label>
          <div class="theme-selector">
            <div class="theme-dot purple active" onclick="setTheme('purple')" title="Purple"></div>
            <div class="theme-dot ocean" onclick="setTheme('ocean')" title="Ocean"></div>
            <div class="theme-dot sunset" onclick="setTheme('sunset')" title="Sunset"></div>
            <div class="theme-dot forest" onclick="setTheme('forest')" title="Forest"></div>
            <div class="theme-dot night" onclick="setTheme('night')" title="Night"></div>
            <div class="theme-dot rose" onclick="setTheme('rose')" title="Rose"></div>
            <div class="theme-dot dark" onclick="setTheme('dark')" title="Dark"></div>
          </div>
        </div>

        <label class="pdf-toggle">
          <input type="checkbox" id="pdfPreviewToggle" checked />
          <span>PDF Preview</span>
        </label>
      </div>

      <div id="content"></div>
    </main>
  </div>

  <button id="backToTop" class="back-to-top" title="Back to top" aria-label="Back to top">‚Üë</button>

  <script>
    function isMobileMode(){
  // English comment: Treat <=768px as mobile mode
      return window.matchMedia && window.matchMedia('(max-width: 768px)').matches;
    }

    const PROXY_SERVICES = [
      url => `https://corsproxy.io/?${encodeURIComponent(url)}`,
      url => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`,
      url => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`
    ];

    const CATEGORIES = [
      { code: 'astro-ph', label: 'Astrophysics (all)' },
      { code: 'astro-ph.CO', label: 'Cosmology & Nongalactic' },
      { code: 'astro-ph.EP', label: 'Earth & Planetary' },
      { code: 'astro-ph.GA', label: 'Astrophysics of Galaxies' },
      { code: 'astro-ph.HE', label: 'High Energy Phenomena' },
      { code: 'astro-ph.IM', label: 'Instrumentation & Methods' },
      { code: 'astro-ph.SR', label: 'Solar & Stellar' }
    ];

    let selectedCategory = 'astro-ph';
    let currentSelectedCard = null;
    let currentDateRange = 1;
    let sectionColumns = { new: 2, cross: 2, repl: 2 };

    // Settings management with localStorage
    function saveSettings() {
      const settings = {
        theme: document.body.className.replace('theme-', ''),
        dateRange: currentDateRange,
        sectionColumns: sectionColumns,
        pdfPreview: document.getElementById('pdfPreviewToggle').checked,
        selectedCategory: selectedCategory
      };
      localStorage.setItem('arxivSettings', JSON.stringify(settings));
    }

    function loadSettings() {
      const saved = localStorage.getItem('arxivSettings');
      if (!saved) return null;
      
      try {
        return JSON.parse(saved);
      } catch (e) {
        console.error('Failed to parse settings:', e);
        return null;
      }
    }

    function applySettings(settings) {
      if (!settings) return;
      
      // Apply theme
      if (settings.theme) {
        setTheme(settings.theme, false);
      }
      
      // Apply date range
      if (settings.dateRange) {
        currentDateRange = settings.dateRange;
        document.querySelectorAll('.range-btn').forEach(btn => {
          btn.classList.remove('active');
          if (parseInt(btn.getAttribute('data-range')) === settings.dateRange) {
            btn.classList.add('active');
          }
        });
      }
      
      // Apply section columns
      if (settings.sectionColumns) {
        sectionColumns = settings.sectionColumns;
      }
      
      // Apply PDF preview toggle
      if (settings.pdfPreview !== undefined) {
        document.getElementById('pdfPreviewToggle').checked = settings.pdfPreview;
      }
      
      // Apply selected category
      if (settings.selectedCategory) {
        selectedCategory = settings.selectedCategory;
      }
    }

    function pad2(n){ return String(n).padStart(2, '0'); }
    function escapeHtml(text){
      const div = document.createElement('div');
      div.textContent = text ?? '';
      return div.innerHTML;
    }
    function cleanText(s){ return (s ?? '').replace(/\s+/g, ' ').trim(); }

    function setStatus(message){
      document.getElementById('content').innerHTML = `<div class="status">${message}<br/><span class="mono"> </span></div>`;
    }

    function setTheme(theme, save = true){
      document.body.className = `theme-${theme}`;
      
      // Update active dot
      document.querySelectorAll('.theme-dot').forEach(dot => {
        dot.classList.remove('active');
      });
      document.querySelector(`.theme-dot.${theme}`).classList.add('active');
      
      if (save) saveSettings();
    }

    function renderCategoryTabs(){
      const container = document.getElementById('categoryTabs');
      if (!container) return;

      container.innerHTML = '';
      for (const cat of CATEGORIES){
        const tab = document.createElement('div');
        tab.className = `category-tab ${cat.code === selectedCategory ? 'active' : ''}`;
        tab.textContent = cat.label;
        tab.onclick = () => {
          selectedCategory = cat.code;
          saveSettings();
          renderCategoryTabs();
          loadPapers();
        };
        container.appendChild(tab);
      }
    }

    function setDateRange(days){
      currentDateRange = days;
      
      document.querySelectorAll('.range-btn').forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.getAttribute('data-range')) === days){
          btn.classList.add('active');
        }
      });
      
      saveSettings();
      loadPapers();
    }

    function setSectionColumns(section, cols){
      sectionColumns[section] = cols;
      saveSettings();
      if (window.__LAST_RENDER_META__){
        renderSections(window.__LAST_RENDER_META__);
      }
    }

    function getDateList(endDate, days){
      const dates = [];
      const dt = new Date(`${endDate}T00:00:00`);
      
      for (let i = 0; i < days; i++){
        const ymd = `${dt.getFullYear()}-${pad2(dt.getMonth() + 1)}-${pad2(dt.getDate())}`;
        dates.push(ymd);
        dt.setDate(dt.getDate() - 1);
      }
      
      return dates;
    }

    async function fetchWithProxy(url, accept, proxyIndex = 0){
      if (proxyIndex >= PROXY_SERVICES.length) throw new Error('All proxy services failed');
      const proxyUrl = PROXY_SERVICES[proxyIndex](url);

      try{
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 30000);

        const resp = await fetch(proxyUrl, {
          method: 'GET',
          signal: controller.signal,
          headers: { 'Accept': accept }
        });

        clearTimeout(timeoutId);

        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const text = await resp.text();
        if (!text || text.length < 50) throw new Error('Empty response');
        return text;
      } catch (e){
        return fetchWithProxy(url, accept, proxyIndex + 1);
      }
    }

    function normalizeId(id){ return (id || '').trim().replace(/v\d+$/i, ''); }

    function extractIdFromAbsUrl(url){
      const m = (url || '').match(/\/abs\/([^?#]+)/);
      return m && m[1] ? normalizeId(m[1]) : '';
    }

    function chunkArray(arr, size){
      const out = [];
      for (let i = 0; i < arr.length; i += size) out.push(arr.slice(i, i + size));
      return out;
    }

    function parseCatchupByHeadings(htmlText){
      const doc = new DOMParser().parseFromString(htmlText, "text/html");
      const root = doc.querySelector('#content') || doc;

      const h3s = Array.from(root.querySelectorAll('h3'));
      const out = { new: [], cross: [], repl: [] };

      function keyForHeadingText(t){
        const s = cleanText(t).toLowerCase();
        if (s.startsWith('new submissions')) return 'new';
        if (s.startsWith('cross submissions') || s.startsWith('cross-lists') || s.startsWith('cross lists')) return 'cross';
        if (s.startsWith('replacement submissions') || s.startsWith('replacements')) return 'repl';
        return null;
      }

      for (const h3 of h3s){
        const key = keyForHeadingText(h3.textContent || '');
        if (!key) continue;

        let node = h3.nextElementSibling;
        while (node){
          if (node.tagName && node.tagName.toLowerCase() === 'h3') break;

          const absLinks = Array.from(node.querySelectorAll('a[href*="/abs/"]'));
          for (const a of absLinks){
            const href = a.getAttribute('href') || '';
            const id = extractIdFromAbsUrl(href);
            if (id) out[key].push(id);
          }
          node = node.nextElementSibling;
        }
      }
      return out;
    }

    function parseArxivApi(xmlText){
      const parser = new DOMParser();
      const xmlDoc = parser.parseFromString(xmlText, "text/xml");
      const parserError = xmlDoc.querySelector('parsererror');
      if (parserError) throw new Error('API XML parsing failed');

      const entries = xmlDoc.getElementsByTagName("entry");
      const papers = [];

      for (const entry of entries){
        const title = cleanText(entry.getElementsByTagName("title")[0]?.textContent);
        const summary = cleanText(entry.getElementsByTagName("summary")[0]?.textContent);
        const published = entry.getElementsByTagName("published")[0]?.textContent;
        const updated = entry.getElementsByTagName("updated")[0]?.textContent;
        const idUrl = entry.getElementsByTagName("id")[0]?.textContent;

        if (!title || !summary || !idUrl) continue;

        papers.push({
          absId: extractIdFromAbsUrl(idUrl),
          title,
          summary,
          published: published ? new Date(published) : null,
          updated: updated ? new Date(updated) : null,
          link: idUrl,
          authors: Array.from(entry.getElementsByTagName("author"))
            .map(a => a.getElementsByTagName("name")[0]?.textContent?.trim())
            .filter(Boolean),
          categories: Array.from(entry.getElementsByTagName("category"))
            .map(c => c.getAttribute("term"))
            .filter(Boolean)
        });
      }
      return papers;
    }

    async function fetchPapersForIds(ids){
      const idChunks = chunkArray(ids, 200);
      const all = [];

      for (const chunk of idChunks){
        const apiUrl =
          `https://export.arxiv.org/api/query?id_list=${encodeURIComponent(chunk.join(','))}` +
          `&start=0&max_results=${encodeURIComponent(chunk.length)}`;
        const xmlText = await fetchWithProxy(apiUrl, 'application/atom+xml, application/xml, text/xml');
        all.push(...parseArxivApi(xmlText));
      }

      const byAbsId = new Map();
      for (const p of all){
        if (p.absId) byAbsId.set(p.absId, p);
      }
      return byAbsId;
    }

    function renderPapersGrid(papers, sec){
      if (!papers.length){
        return `<div class="info">No papers available</div>`;
      }

      const cols = sectionColumns[sec] || 2;
      let html = `<div class="papers-grid cols-${cols}">`;

      for (const p of papers){
        const authorsText = p.authors?.length
          ? `${p.authors.slice(0, 3).join(', ')}${p.authors.length > 3 ? ' et al.' : ''}`
          : 'Unknown authors';

        const dateStr = p.published ? p.published.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : '';

        html += `
          <div class="paper-card"
               tabindex="0"
               data-absid="${escapeHtml(p.absId)}"
               data-sec="${escapeHtml(sec || '')}"
               data-date="${escapeHtml(p.catchupDate || '')}">

            <div class="paper-title">${escapeHtml(p.title)}</div>
            <div class="paper-authors">${escapeHtml(authorsText)}</div>
            ${dateStr ? `<div class="paper-date">üìÖ ${escapeHtml(dateStr)}</div>` : ''}
            <div class="paper-footer">
              <a class="paper-link" href="${escapeHtml(p.link)}" target="_blank" onclick="event.stopPropagation()">Open arXiv</a>
              <a class="paper-link" href="https://arxiv.org/pdf/${escapeHtml(p.absId)}.pdf" target="_blank" onclick="event.stopPropagation()">Open PDF</a>
            </div>
          </div>
        `;
      }

      html += `</div>`;
      return html;
    }

    function renderPreviewEmpty(){
      return `
        <div class="preview-muted">
          Click on a paper card to see the abstract and PDF preview here.
        </div>
      `;
    }

    function setPreviewPaper(paper){
      const abstractPane = document.getElementById('abstractPane');
      const pdfPane = document.getElementById('pdfPane');
      
      if (!abstractPane || !pdfPane) return;

      if (currentSelectedCard){
        currentSelectedCard.classList.remove('selected');
      }

      const cards = document.querySelectorAll('.paper-card');
      for (const card of cards){
        if (card.getAttribute('data-absid') === paper.absId){
          card.classList.add('selected');
          currentSelectedCard = card;
          break;
        }
      }

      const MAX_AUTHORS_PREVIEW = 6;
      const authors = (paper.authors || []).filter(Boolean);

      const authorsFull =
          authors.length <= MAX_AUTHORS_PREVIEW
          ? authors.join(', ')
          : `${authors.slice(0, MAX_AUTHORS_PREVIEW).join(', ')}, et al.`;

      abstractPane.innerHTML = `
        <div class="preview-title">${escapeHtml(paper.title || '')}</div>
        <div class="preview-meta">
          <div>${escapeHtml(authorsFull || 'Unknown')}</div>
        </div>
        <div class="preview-abstract">${escapeHtml(paper.summary || '')}</div>
      `;

      const pdfToggle = document.getElementById('pdfPreviewToggle');
      const showPdf = pdfToggle.checked;
      const pdfCard = pdfPane.closest('.pdf-card');

      if (showPdf){
        if (pdfCard) pdfCard.style.display = 'flex';
        
        const pdfUrl = `https://arxiv.org/pdf/${paper.absId}.pdf`;
        pdfPane.innerHTML = `
          <div class="pdf-section-title">
            <span>üìÑ PDF Preview</span>
            <div class="pdf-actions">
              <a class="pdf-btn secondary" href="${escapeHtml(pdfUrl)}" target="_blank">Open in New Tab</a>
            </div>
          </div>
          <div class="pdf-viewer-container">
            <iframe 
              class="pdf-iframe" 
              src="${escapeHtml(pdfUrl)}#view=FitH"
              title="PDF Preview">
            </iframe>
          </div>
        `;
      } else {
        if (pdfCard) pdfCard.style.display = 'none';
      }

      if (window.MathJax) {
          MathJax.typesetPromise([abstractPane]).catch(err => console.log('MathJax error:', err));
      }
    }

    function renderSections(meta){
      const content = document.getElementById('content');

      let html = '';

      if (meta.dateRange && meta.dateRange.length > 1){
        html += `
          <div class="info">
            üìÖ Showing papers from ${escapeHtml(meta.dateRange[meta.dateRange.length - 1])} to ${escapeHtml(meta.dateRange[0])} (${meta.dateRange.length} days)
          </div>
        `;
      }

      html += `
        <div class="content-split">
          <div id="listPane"></div>
          <div class="preview-panels">
            <div class="abstract-card" id="abstractPane">
              ${renderPreviewEmpty()}
            </div>
            <div class="pdf-card" id="pdfPane">
              <div class="preview-muted">PDF will appear here when you select a paper.</div>
            </div>
          </div>
        </div>
      `;

      content.innerHTML = html;
      
      const listPane = document.getElementById('listPane');

      const order = ['new', 'cross', 'repl'];

      let listHtml = '';

      for (const sec of order){
        if (!meta.enabled[sec]) continue;

        const title = sec === 'new' ? 'New submissions' : sec === 'cross' ? 'Cross submissions' : 'Replacement submissions';
        const shown = meta.shownCounts[sec];
        const total = meta.counts[sec];
        const cols = sectionColumns[sec] || 2;

        listHtml += `
          <div class="section">
            <div class="section-title">
              <div class="left">${escapeHtml(title)} <span class="pill">showing ${escapeHtml(String(shown))} / ${escapeHtml(String(total))}</span></div>
              <div class="right">
                <div class="column-toggle-mini">
                  <button class="col-btn ${cols === 1 ? 'active' : ''}" onclick="setSectionColumns('${sec}', 1)">I</button>
                  <button class="col-btn ${cols === 2 ? 'active' : ''}" onclick="setSectionColumns('${sec}', 2)">II</button>
                </div>
              </div>
            </div>
            ${renderPapersGrid(meta.papersBySection[sec], sec)}
          </div>
        `;
      }

      listPane.innerHTML = listHtml;

      const firstPaper = (meta.papersBySection.new?.[0] || meta.papersBySection.cross?.[0] || meta.papersBySection.repl?.[0] || null);
      if (firstPaper && !isMobileMode()) setPreviewPaper(firstPaper);

      
      if (window.MathJax) {
        MathJax.typesetPromise([listPane]).catch(err => console.log('MathJax error:', err));
      }
    }

    function getEnabled(){
      return {
          new: true,
          cross: true,
          repl: true
      };
    }

    function isWeekendYmd(ymd){
      const dt = new Date(`${ymd}T00:00:00`);
      const dow = dt.getDay();
      return dow === 0 || dow === 6 ? dow : -1;
    }

    function getPreviousFriday(ymd){
      const dt = new Date(`${ymd}T00:00:00`);
      const dow = dt.getDay();
      
      let daysToSubtract;
      if (dow === 0) {
        daysToSubtract = 2;
      } else if (dow === 6) {
        daysToSubtract = 1;
      } else {
        return ymd;
      }
      
      dt.setDate(dt.getDate() - daysToSubtract);
      return `${dt.getFullYear()}-${pad2(dt.getMonth() + 1)}-${pad2(dt.getDate())}`;
    }

    function setupDateInput(){
      const dateInput = document.getElementById('day');
      
      dateInput.addEventListener('change', function(){
        const selectedDate = this.value;
        if (!selectedDate) return;
        
        const weekend = isWeekendYmd(selectedDate);
        if (weekend !== -1){
          const friday = getPreviousFriday(selectedDate);
          this.value = friday;
          loadPapers();
        }
      });
    }

    document.getElementById('pdfPreviewToggle').addEventListener('change', function(){
      saveSettings();
      if (currentSelectedCard){
        const absId = currentSelectedCard.getAttribute('data-absid');
        const paper = window.__PAPER_BY_ID__?.get?.(absId);
        if (paper) setPreviewPaper(paper);
      }
    });

    async function loadPapers(){
      const dateInput = document.getElementById('day');
      let selectedYmd = dateInput.value;
      const enabled = getEnabled();

      if (!selectedYmd){
        setStatus('Please select a date.');
        return;
      }

      try{
        const dateList = getDateList(selectedYmd, currentDateRange);
        
        setStatus(`Loading papers from ${dateList.length} day(s)...`);

        const allIdsBySection = { new: [], cross: [], repl: [] };
        const seenIds = { new: new Set(), cross: new Set(), repl: new Set() };

        for (const date of dateList){
          const catchupUrl = `https://arxiv.org/catchup/${encodeURIComponent(selectedCategory)}/${encodeURIComponent(date)}?abs=False`;
          setStatus(`Loading ${escapeHtml(date)}...<br/><span class="mono">${escapeHtml(catchupUrl)}</span>`);

          try{
            const htmlText = await fetchWithProxy(catchupUrl, 'text/html');
            const idsBySection = parseCatchupByHeadings(htmlText);

            for (const sec of ['new', 'cross', 'repl']){
              for (const id of idsBySection[sec]){
                if (!seenIds[sec].has(id)){
                  seenIds[sec].add(id);
                  allIdsBySection[sec].push({ id, date });
                }
              }
            }
          } catch (e){
            console.warn(`Failed to load ${date}:`, e);
          }
        }

        const counts = {
          new: allIdsBySection.new.length,
          cross: allIdsBySection.cross.length,
          repl: allIdsBySection.repl.length
        };

        const papersBySection = { new: [], cross: [], repl: [] };
        const shownCounts = {
          new: enabled.new ? allIdsBySection.new.length : 0,
          cross: enabled.cross ? allIdsBySection.cross.length : 0,
          repl: enabled.repl ? allIdsBySection.repl.length : 0
        };

        for (const sec of ['new', 'cross', 'repl']){
          if (!enabled[sec]) continue;
          if (!allIdsBySection[sec].length) continue;

          setStatus(`Loading metadata: ${sec} (${allIdsBySection[sec].length})‚Ä¶`);
          const ids = allIdsBySection[sec].map(item => item.id);
          const byAbsId = await fetchPapersForIds(ids);

          const ordered = [];
          for (const item of allIdsBySection[sec]){
            const p = byAbsId.get(normalizeId(item.id));
            if (p) {
              p.catchupDate = item.date;
              ordered.push(p);
            }
          }
          papersBySection[sec] = ordered;
        }

        window.__PAPER_BY_ID__ = new Map();
        for (const sec of ['new','cross','repl']){
          for (const p of (papersBySection[sec] || [])){
            if (p?.absId) window.__PAPER_BY_ID__.set(p.absId, p);
          }
        }

        const renderMeta = {
          category: selectedCategory,
          date: selectedYmd,
          dateRange: dateList,
          enabled,
          counts,
          shownCounts,
          papersBySection
        };

        window.__LAST_RENDER_META__ = renderMeta;

        renderSections(renderMeta);
      } catch(e) {
        console.error('Load failed:', e);
      }
    }

    document.addEventListener('click', (e) => {
      const card = e.target?.closest?.('.paper-card');
      if (!card) return;
      const absId = card.getAttribute('data-absid') || '';
      if (!absId) return;
      const p = window.__PAPER_BY_ID__?.get?.(absId);
      if (p && !isMobileMode()) setPreviewPaper(p);
    });

    document.addEventListener('focusin', (e) => {
      const card = e.target?.closest?.('.paper-card');
      if (!card) return;
      const absId = card.getAttribute('data-absid') || '';
      const p = window.__PAPER_BY_ID__?.get?.(absId);
      if (p && !isMobileMode()) setPreviewPaper(p);
    });

    const backToTopBtn = document.getElementById('backToTop');
    function updateBackToTop(){
      if (!backToTopBtn) return;
      backToTopBtn.style.display = (window.scrollY > 500) ? 'flex' : 'none';
    }
    window.addEventListener('scroll', updateBackToTop, { passive: true });
    backToTopBtn.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    window.onload = () => {
      try{
        // Load saved settings first
        const savedSettings = loadSettings();
        
        renderCategoryTabs();
        setupDateInput();

        const d = new Date();
        let initialDate = `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
        
        const weekend = isWeekendYmd(initialDate);
        if (weekend !== -1){
          initialDate = getPreviousFriday(initialDate);
        }
        
        document.getElementById('day').value = initialDate;
        document.getElementById('day').addEventListener('change', loadPapers);

        // Apply saved settings after DOM is ready
        if (savedSettings) {
          applySettings(savedSettings);
          renderCategoryTabs(); // Re-render with saved category
        }
        // English comment: On mobile, disable preview and force PDF off
        if (isMobileMode()){
          const toggle = document.getElementById('pdfPreviewToggle');
          if (toggle){
            toggle.checked = false;
          }
          saveSettings();
        }

        updateBackToTop();
        setTimeout(loadPapers, 250);
      } catch (e){
        console.error('Init failed:', e);
      }
    };
  </script>
</body>
</html>
